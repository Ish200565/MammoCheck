<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radiologist Dashboard - MammoCheck</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>ðŸ”¬ Radiologist Dashboard</h1>
                <p style="color: #7f8c8d; margin-top: 5px;">Mammography Analysis & Reports</p>
            </div>
            
            <!-- User Profile Section -->
            {% if session.get('logged_in_with_google') %}
            <div style="display: flex; align-items: center; gap: 15px;">
                {% if session.get('user_picture') %}
                <img src="{{ session['user_picture'] }}" 
                     alt="Profile" 
                     style="width: 50px; height: 50px; border-radius: 50%; border: 2px solid #667eea;">
                {% endif %}
                <div>
                    <strong style="display: block; color: #2c3e50;">{{ session.get('user_name', 'User') }}</strong>
                    <small style="color: #7f8c8d;">{{ session.get('user_email', '') }}</small>
                </div>
            </div>
            {% endif %}
            
            <nav>
                <a href="{{ url_for('doctor_dashboard') }}" class="btn btn-secondary">Doctor Dashboard</a>
                <a href="{{ url_for('appointments_page') }}" class="btn btn-secondary">Appointments</a>
                {% if session.get('logged_in_with_google') %}
                <a href="{{ url_for('logout') }}" class="btn btn-danger">Logout</a>
                {% else %}
                <a href="{{ url_for('home') }}" class="btn btn-secondary">Home</a>
                {% endif %}
            </nav>
        </header>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Upload Image Section -->
        <section class="appointment-form">
            <h2>ðŸ“¤ Upload Mammogram Image</h2>
            <form action="/upload_image" method="POST" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="file">Select Mammogram Image:</label>
                    <input type="file" name="file" id="file" accept="image/*" required>
                </div>
                <button type="submit" class="btn btn-primary">Upload & Analyze</button>
            </form>
        </section>

        <!-- Analysis Results & Report Submission -->
        {% if density %}
        <section class="appointment-form" style="border: 2px solid #28a745;">
            <h2>âœ… Analysis Complete</h2>
            <div style="background-color: #d4edda; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <p style="font-size: 1.2em; margin: 0; color: #155724;">
                    <strong>Predicted Density:</strong> {{ density }}
                </p>
            </div>

            {% if image %}
            <div style="text-align: center; margin-bottom: 20px;">
                <img src="{{ url_for('static', filename='uploads/' + image) }}" 
                     alt="Uploaded Mammogram" 
                     style="max-width: 400px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
            </div>
            {% endif %}

            <h3>Submit Patient Report</h3>
            <form action="/submit_report" method="POST">
                <input type="hidden" name="density" value="{{ density }}">
                
                <div class="form-group">
                    <label for="patient_name">Patient Name *</label>
                    <input type="text" name="patient_name" id="patient_name" required>
                </div>

                <div class="form-group">
                    <label for="diagnosis">Diagnosis *</label>
                    <input type="text" name="diagnosis" id="diagnosis" required 
                           placeholder="e.g., Normal, Requires follow-up">
                </div>

                <div class="form-group">
                    <label for="notes">Additional Notes</label>
                    <textarea name="notes" id="notes" rows="4" 
                              placeholder="Additional observations or recommendations..."></textarea>
                </div>

                <button type="submit" class="btn btn-success">Submit Report</button>
            </form>
        </section>
        {% endif %}

        <!-- Information Section -->
        <section class="info-section">
            <h3>ðŸ“Œ Workflow:</h3>
            <ol>
                <li><strong>Upload:</strong> Select and upload a mammogram image</li>
                <li><strong>Analyze:</strong> AI model predicts breast density</li>
                <li><strong>Review:</strong> Verify the analysis results</li>
                <li><strong>Report:</strong> Fill in patient details and diagnosis</li>
                <li><strong>Submit:</strong> Save report to database for doctor review</li>
            </ol>
        </section>
    </div>
</body>
</html>