{% extends 'base.html' %}
{% block title %}MammoCheck - Login{% endblock %}

{% block content %}
<!-- ==================== LOGIN PAGE ==================== -->
<div id="loginPage" class="page active">
    <div class="login-container-split">
        <!-- LEFT SIDE: Branding & Information -->
        <div class="login-left">
            <div class="brand-section">
                <div class="medical-icon">üè•</div>
                <h1 class="brand-title">MammoCheck</h1>
                <p class="brand-subtitle">Advanced Breast Density Classification & Diagnostic System</p>
                <p class="brand-description">
                    Empowering healthcare professionals with AI-powered mammogram analysis for early detection and better patient outcomes.
                </p>
                
                <div class="features-list">
                    <div class="feature-item">
                        <span class="feature-icon">‚úì</span>
                        <span class="feature-text">HIPAA Compliant Security</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">‚úì</span>
                        <span class="feature-text">End-to-End Encryption</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">‚úì</span>
                        <span class="feature-text">AI-Powered Analysis</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">‚úì</span>
                        <span class="feature-text">Real-Time Classification</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- RIGHT SIDE: Role Selection & Login -->
        <div class="login-right">
            <div class="role-selection-container">
                <h2 class="selection-title">üë§ Select Your Role</h2>
                <p class="selection-subtitle">Choose your professional role to continue</p>
                
                <div class="role-cards">
                    <div class="role-card doctor-card" onclick="setRoleSelection('doctor')">
                        <div class="role-icon">üë®‚Äç‚öïÔ∏è</div>
                        <div class="role-card-content">
                            <h3 class="role-title">Doctor</h3>
                            <p class="role-description">Access patient reports and view classifications</p>
                        </div>
                        <div class="role-check" id="doctor-check">‚úì</div>
                    </div>
                    
                    <div class="role-card radiologist-card" onclick="setRoleSelection('radiologist')">
                        <div class="role-icon">üë©‚Äç‚öïÔ∏è</div>
                        <div class="role-card-content">
                            <h3 class="role-title">Radiologist</h3>
                            <p class="role-description">Upload images and perform analysis</p>
                        </div>
                        <div class="role-check" id="radiologist-check">‚úì</div>
                    </div>
                </div>
                
                <div class="google-login-section">
                    <button class="google-login-btn" onclick="loginWithGoogle()" id="googleLoginBtn" disabled>
                        <svg class="google-icon" viewBox="0 0 24 24">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        <span>Sign in with Google</span>
                    </button>
                    <p class="login-note">üîí Please select your role above to continue</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Keep old upload form for backward compatibility -->
<div id="oldUploadForm" style="display: none;">
    <h2>Breast Density Classification</h2>
    <form id="uploadForm">
        <div class="upload-box">
            <label>LCC: </label><input type="file" name="LCC" accept="image/*" required><br>
            <label>LMLO: </label><input type="file" name="LMLO" accept="image/*" required><br>
            <label>RCC: </label><input type="file" name="RCC" accept="image/*" required><br>
            <label>RMLO: </label><input type="file" name="RMLO" accept="image/*" required><br>
        </div><br>
        <button type="submit">Detect</button>
    </form>

    <div id="results"></div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Old upload form functionality (preserved for backward compatibility)
if (document.getElementById('uploadForm')) {
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const formData = new FormData(form);
        const filesMap = {};
        ['LCC','LMLO','RCC','RMLO'].forEach(key => {
            const input = form.querySelector(`input[name="${key}"]`);
            if (input && input.files && input.files[0]) filesMap[key] = input.files[0];
        });
        const res = await fetch('/predict', {
            method: 'POST',
            body: formData
        });
        if (!res.ok) {
            const text = await res.text();
            alert('Server error: ' + text);
            return;
        }
        const data = await res.json();
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '';
        data.results.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            const h3 = document.createElement('h3');
            h3.textContent = item.view || '';
            card.appendChild(h3);
            const file = filesMap[item.view];
            if (file) {
                const img = document.createElement('img');
                img.alt = item.view + ' preview';
                img.src = URL.createObjectURL(file);
                img.onload = () => URL.revokeObjectURL(img.src);
                card.appendChild(img);
            }
            if (item.error) {
                const p = document.createElement('p');
                p.textContent = item.error;
                card.appendChild(p);
            } else {
                const pPred = document.createElement('p');
                pPred.innerHTML = `<b>Prediction:</b> ${item.label} (${item.prediction})`;
                card.appendChild(pPred);
                const pConf = document.createElement('p');
                pConf.innerHTML = `<b>Confidence:</b> ${item.confidence}`;
                card.appendChild(pConf);
                const pTime = document.createElement('p');
                pTime.innerHTML = `<b>Time:</b> ${item.time}`;
                card.appendChild(pTime);
            }
            resultsDiv.appendChild(card);
        });
    });
}
</script>
{% endblock %}
