{% extends 'base.html' %}
{% block title %}MammoCheck - Login{% endblock %}

{% block content %}
<!-- ==================== LOGIN PAGE ==================== -->
<div id="loginPage" class="page active">
    <div class="login-container">
        <h1 class="brand-title">MammoCheck</h1>
        <p class="brand-subtitle">Breast Density Classification & Diagnostic System</p>
        
        <div class="login-options">
            <button class="login-btn doctor-btn" onclick="selectRole('doctor')">
                <span class="icon">üë®‚Äç‚öïÔ∏è</span>
                <span class="role-text">Doctor Login</span>
                <span class="role-desc">View patient reports & classifications</span>
            </button>
            
            <button class="login-btn radiologist-btn" onclick="selectRole('radiologist')">
                <span class="icon">üë©‚Äç‚öïÔ∏è</span>
                <span class="role-text">Radiologist Login</span>
                <span class="role-desc">Add patients & upload images</span>
            </button>
        </div>
    </div>
</div>

<!-- Keep old upload form for backward compatibility -->
<div id="oldUploadForm" style="display: none;">
    <h2>Breast Density Classification</h2>
    <form id="uploadForm">
        <div class="upload-box">
            <label>LCC: </label><input type="file" name="LCC" accept="image/*" required><br>
            <label>LMLO: </label><input type="file" name="LMLO" accept="image/*" required><br>
            <label>RCC: </label><input type="file" name="RCC" accept="image/*" required><br>
            <label>RMLO: </label><input type="file" name="RMLO" accept="image/*" required><br>
        </div><br>
        <button type="submit">Detect</button>
    </form>

    <div id="results"></div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Old upload form functionality (preserved for backward compatibility)
if (document.getElementById('uploadForm')) {
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const formData = new FormData(form);
        const filesMap = {};
        ['LCC','LMLO','RCC','RMLO'].forEach(key => {
            const input = form.querySelector(`input[name="${key}"]`);
            if (input && input.files && input.files[0]) filesMap[key] = input.files[0];
        });
        const res = await fetch('/predict', {
            method: 'POST',
            body: formData
        });
        if (!res.ok) {
            const text = await res.text();
            alert('Server error: ' + text);
            return;
        }
        const data = await res.json();
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '';
        data.results.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            const h3 = document.createElement('h3');
            h3.textContent = item.view || '';
            card.appendChild(h3);
            const file = filesMap[item.view];
            if (file) {
                const img = document.createElement('img');
                img.alt = item.view + ' preview';
                img.src = URL.createObjectURL(file);
                img.onload = () => URL.revokeObjectURL(img.src);
                card.appendChild(img);
            }
            if (item.error) {
                const p = document.createElement('p');
                p.textContent = item.error;
                card.appendChild(p);
            } else {
                const pPred = document.createElement('p');
                pPred.innerHTML = `<b>Prediction:</b> ${item.label} (${item.prediction})`;
                card.appendChild(pPred);
                const pConf = document.createElement('p');
                pConf.innerHTML = `<b>Confidence:</b> ${item.confidence}`;
                card.appendChild(pConf);
                const pTime = document.createElement('p');
                pTime.innerHTML = `<b>Time:</b> ${item.time}`;
                card.appendChild(pTime);
            }
            resultsDiv.appendChild(card);
        });
    });
}
</script>
{% endblock %}
